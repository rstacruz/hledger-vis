#!/usr/bin/env node
const chalk = require('chalk')
const cli = require('meow')(`
  Usage:
    $ hledger-vis

  Options:
    -p, --port=PORT  port number
        --no-open    don't open in the browser
    -f, --file=FILE  file to load

  Other options:
    -h, --help       show usage information
    -v, --version    print version info and exit
`, {
  boolean: ['help', 'version', 'open'],
  string: ['port', 'file'],
  alias: {
    h: 'help', v: 'version', p: 'port', f: 'file'
  },
  default: {
    open: true
  }
})

const port = cli.flags.port || process.env['PORT'] || require('get-port')()

const app = require('../lib/server')()

Promise.resolve(port)
.then(port => {
  const url = 'http://localhost:' + port
  require('http').createServer(app.callback()).listen(port)

  if (cli.flags.open === false) {
    console.log('')
    console.log(' ' + chalk.green('âœ“') + ' ' + chalk.bold('hledger-vis started'))
    console.log('   ' + chalk.underline(url))
    console.log('')
  } else {
    require('open')(url)
  }
})

